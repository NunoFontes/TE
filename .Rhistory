tempdf$Indicator = paste("(",tempdf$Indicator,")", sep = "")
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempdf = aggregate(Close ~ DateTime, data = tempdf, theAction)
tempIndicator = tempdf$Indicator[1]
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf)
}
}else{
if(is.na(match(tolower(tempSubjects[t]),tolower(GROUPS_OF_COUNTRIES)))){
tempdf=te.get.hist.multi.free.new(tempSubjects[t],object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Indicator[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))] = countrycode(tempdf$Country,"country.name","iso3c")[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))]
tempdf$Indicator[tolower(tempdf$Country)=="euro area"] <- "EA17"
tempdf$Indicator = paste("(",tempdf$Indicator,")", sep = "")
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempIndicator = tempdf$Indicator[1]
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf[c("DateTime","Close","Indicator")])
thenames = unique(provisionaldf$Indicator)
provisionaldf = aggregate(Close ~ DateTime, data = provisionaldf, theAction)
provisionaldf$Indicator = paste(thenames,collapse = " + ")
}else{
withLogic = te.group.of.countries(tempSubjects[t],"Atlantis")
tempdf=te.get.hist.multi.free.new(withLogic,object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Indicator = paste("(",tempSubjects[t],")", sep = "")
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempdf = aggregate(Close ~ DateTime, data = tempdf, theAction)
tempIndicator = tempdf$Indicator[1]
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf)
}
}
}
thenames = unique(provisionaldf$Indicator)
provisionaldf = aggregate(Close ~ DateTime, data = provisionaldf, theAction)
provisionaldf$Indicator = paste(thenames,collapse = " + ")
dataFrame = rbind(dataFrame,provisionaldf)
}
SINCE = "1999"
options(stringsAsFactors = FALSE)
#subjects = "United States_#_Europe_-_Germany_#_Europe_"
subjects = gsub("_", "", subjects)
subjects = strsplit(subjects,"\\#")[[1]]
howManyLines = length(subjects)
dataFrame = list()
toDebug = ""
if (grepl("rate",tolower(object)){theAction = "mean"}else{theAction="sum"}
for(l in 1:howManyLines){
provisionaldf = list()
tempSubjects = strsplit(subjects[l],"\\+")[[1]]
for(t in 1:length(tempSubjects)){
tempdf = list()
if(grepl("\\-",tempSubjects[t])){
with = strsplit(tempSubjects,"\\-")[[1]][1]
without = strsplit(tempSubjects,"\\-")[[1]][2:length(strsplit(tempSubjects,"\\-")[[1]])]
if(is.na(match(tolower(with),tolower(GROUPS_OF_COUNTRIES)))){
tempdf=te.get.hist.multi.free.new(with,object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Country[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))] <- countrycode(tempdf$Country,"country.name","iso3c")[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))]
tempdf$Country[tolower(tempdf$Country)=="euro area"] <- "EA17"
tempdf$Indicator = tempdf$Country
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempIndicator = tempdf$Indicator[1]
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf)
}else{
withLogic = te.group.of.countries(with,without)
tempdf=te.get.hist.multi.free.new(withLogic,object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Indicator = paste(with,paste(countrycode(without,"country.name","iso3c")[!is.na(countrycode(without,"country.name","iso3c"))],collapse=" & "),sep=" - ")
tempdf$Indicator = paste("(",tempdf$Indicator,")", sep = "")
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempdf = aggregate(Close ~ DateTime, data = tempdf, theAction)
tempIndicator = tempdf$Indicator[1]
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf)
}
}else{
if(is.na(match(tolower(tempSubjects[t]),tolower(GROUPS_OF_COUNTRIES)))){
tempdf=te.get.hist.multi.free.new(tempSubjects[t],object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Indicator[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))] = countrycode(tempdf$Country,"country.name","iso3c")[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))]
tempdf$Indicator[tolower(tempdf$Country)=="euro area"] <- "EA17"
tempdf$Indicator = paste("(",tempdf$Indicator,")", sep = "")
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempIndicator = tempdf$Indicator[1]
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf[c("DateTime","Close","Indicator")])
thenames = unique(provisionaldf$Indicator)
provisionaldf = aggregate(Close ~ DateTime, data = provisionaldf, theAction)
provisionaldf$Indicator = paste(thenames,collapse = " + ")
}else{
withLogic = te.group.of.countries(tempSubjects[t],"Atlantis")
tempdf=te.get.hist.multi.free.new(withLogic,object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Indicator = paste("(",tempSubjects[t],")", sep = "")
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempdf = aggregate(Close ~ DateTime, data = tempdf, theAction)
tempIndicator = tempdf$Indicator[1]
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf)
}
}
}
thenames = unique(provisionaldf$Indicator)
provisionaldf = aggregate(Close ~ DateTime, data = provisionaldf, theAction)
provisionaldf$Indicator = paste(thenames,collapse = " + ")
dataFrame = rbind(dataFrame,provisionaldf)
dataFrame
}
dataFrame$DateTime <- as.Date(dataFrame$DateTime)
ggplot(dataFrame,aes(x=(DateTime), y=Close, colour=Indicator)) +
geom_line() +
xlab("") + ylab("") +
theme(axis.text.y = element_text(),
panel.border=element_blank(),
axis.line=element_line(colour = "grey",size=.3),
panel.background = element_blank(),
panel.grid.minor = element_line(colour = "grey",size=.2),
panel.grid.major = element_line(colour = "grey",size=.3)) +
theme(legend.position="right") +
ggtitle(object) +
theme(plot.title = element_text(face="bold"))
dataFrame
SINCE = "1999"
options(stringsAsFactors = FALSE)
subjects = "United States_#_Europe_-_Germany_#_Europe_"
subjects = gsub("_", "", subjects)
subjects = strsplit(subjects,"\\#")[[1]]
howManyLines = length(subjects)
dataFrame = list()
toDebug = ""
if (grepl("rate",tolower(object)){theAction = "mean"}else{theAction="sum"}
for(l in 1:howManyLines){
provisionaldf = list()
tempSubjects = strsplit(subjects[l],"\\+")[[1]]
for(t in 1:length(tempSubjects)){
tempdf = list()
if(grepl("\\-",tempSubjects[t])){
with = strsplit(tempSubjects,"\\-")[[1]][1]
without = strsplit(tempSubjects,"\\-")[[1]][2:length(strsplit(tempSubjects,"\\-")[[1]])]
if(is.na(match(tolower(with),tolower(GROUPS_OF_COUNTRIES)))){
tempdf=te.get.hist.multi.free.new(with,object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Country[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))] <- countrycode(tempdf$Country,"country.name","iso3c")[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))]
tempdf$Country[tolower(tempdf$Country)=="euro area"] <- "EA17"
tempdf$Indicator = tempdf$Country
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempIndicator = tempdf$Indicator[1]
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf)
}else{
withLogic = te.group.of.countries(with,without)
tempdf=te.get.hist.multi.free.new(withLogic,object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Indicator = paste(with,paste(countrycode(without,"country.name","iso3c")[!is.na(countrycode(without,"country.name","iso3c"))],collapse=" & "),sep=" - ")
tempdf$Indicator = paste("(",tempdf$Indicator,")", sep = "")
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempdf = aggregate(Close ~ DateTime, data = tempdf, theAction)
tempIndicator = tempdf$Indicator[1]
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf)
}
}else{
if(is.na(match(tolower(tempSubjects[t]),tolower(GROUPS_OF_COUNTRIES)))){
tempdf=te.get.hist.multi.free.new(tempSubjects[t],object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Indicator[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))] = countrycode(tempdf$Country,"country.name","iso3c")[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))]
tempdf$Indicator[tolower(tempdf$Country)=="euro area"] <- "EA17"
tempdf$Indicator = paste("(",tempdf$Indicator,")", sep = "")
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempIndicator = tempdf$Indicator[1]
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf[c("DateTime","Close","Indicator")])
thenames = unique(provisionaldf$Indicator)
provisionaldf = aggregate(Close ~ DateTime, data = provisionaldf, theAction)
provisionaldf$Indicator = paste(thenames,collapse = " + ")
}else{
withLogic = te.group.of.countries(tempSubjects[t],"Atlantis")
tempdf=te.get.hist.multi.free.new(withLogic,object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Indicator = paste("(",tempSubjects[t],")", sep = "")
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempdf = aggregate(Close ~ DateTime, data = tempdf, theAction)
tempIndicator = tempdf$Indicator[1]
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf)
}
}
}
thenames = unique(provisionaldf$Indicator)
provisionaldf = aggregate(Close ~ DateTime, data = provisionaldf, theAction)
provisionaldf$Indicator = paste(thenames,collapse = " + ")
dataFrame = rbind(dataFrame,provisionaldf)
}
dataFrame$DateTime <- as.Date(dataFrame$DateTime)
ggplot(dataFrame,aes(x=(DateTime), y=Close, colour=Indicator)) +
geom_line() +
xlab("") + ylab("") +
theme(axis.text.y = element_text(),
panel.border=element_blank(),
axis.line=element_line(colour = "grey",size=.3),
panel.background = element_blank(),
panel.grid.minor = element_line(colour = "grey",size=.2),
panel.grid.major = element_line(colour = "grey",size=.3)) +
theme(legend.position="right") +
ggtitle(object) +
theme(plot.title = element_text(face="bold"))
object
l=2
tempSubjects = strsplit(subjects[l],"\\+")[[1]]
tempdf = list()
grepl("\\-",tempSubjects[t])
with = strsplit(tempSubjects,"\\-")[[1]][1]
without = strsplit(tempSubjects,"\\-")[[1]][2:length(strsplit(tempSubjects,"\\-")[[1]])]
with
without
is.na(match(tolower(with),tolower(GROUPS_OF_COUNTRIES)))
withLogic = te.group.of.countries(with,without)
tempdf=te.get.hist.multi.free.new(withLogic,object,d1=SINCE)
tempdf
tempdf$Indicator = paste(with,paste(countrycode(without,"country.name","iso3c")[!is.na(countrycode(without,"country.name","iso3c"))],collapse=" & "),sep=" - ")
tempdf$Indicator = paste("(",tempdf$Indicator,")", sep = "")
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempdf = aggregate(Close ~ DateTime, data = tempdf, theAction)
tempdf
theAction
tempIndicator = tempdf$Indicator[1]
tempIndicator
SINCE = "1999"
options(stringsAsFactors = FALSE)
subjects = "United States_#_Europe_-_Germany_#_Europe_"
subjects = gsub("_", "", subjects)
subjects = strsplit(subjects,"\\#")[[1]]
howManyLines = length(subjects)
dataFrame = list()
toDebug = ""
if (grepl("rate",tolower(object)){theAction = "mean"}else{theAction="sum"}
for(l in 1:howManyLines){
provisionaldf = list()
tempSubjects = strsplit(subjects[l],"\\+")[[1]]
for(t in 1:length(tempSubjects)){
tempdf = list()
if(grepl("\\-",tempSubjects[t])){
with = strsplit(tempSubjects,"\\-")[[1]][1]
without = strsplit(tempSubjects,"\\-")[[1]][2:length(strsplit(tempSubjects,"\\-")[[1]])]
if(is.na(match(tolower(with),tolower(GROUPS_OF_COUNTRIES)))){
tempdf=te.get.hist.multi.free.new(with,object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Country[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))] <- countrycode(tempdf$Country,"country.name","iso3c")[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))]
tempdf$Country[tolower(tempdf$Country)=="euro area"] <- "EA17"
tempdf$Indicator = tempdf$Country
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempIndicator = tempdf$Indicator[1]
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf)
}else{
withLogic = te.group.of.countries(with,without)
tempdf=te.get.hist.multi.free.new(withLogic,object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Indicator = paste(with,paste(countrycode(without,"country.name","iso3c")[!is.na(countrycode(without,"country.name","iso3c"))],collapse=" & "),sep=" - ")
tempdf$Indicator = paste("(",tempdf$Indicator,")", sep = "")
tempIndicator = tempdf$Indicator[1]
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempdf = aggregate(Close ~ DateTime, data = tempdf, theAction)
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf)
}
}else{
if(is.na(match(tolower(tempSubjects[t]),tolower(GROUPS_OF_COUNTRIES)))){
tempdf=te.get.hist.multi.free.new(tempSubjects[t],object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Indicator[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))] = countrycode(tempdf$Country,"country.name","iso3c")[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))]
tempdf$Indicator[tolower(tempdf$Country)=="euro area"] <- "EA17"
tempdf$Indicator = paste("(",tempdf$Indicator,")", sep = "")
tempIndicator = tempdf$Indicator[1]
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf[c("DateTime","Close","Indicator")])
thenames = unique(provisionaldf$Indicator)
provisionaldf = aggregate(Close ~ DateTime, data = provisionaldf, theAction)
provisionaldf$Indicator = paste(thenames,collapse = " + ")
}else{
withLogic = te.group.of.countries(tempSubjects[t],"Atlantis")
tempdf=te.get.hist.multi.free.new(withLogic,object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Indicator = paste("(",tempSubjects[t],")", sep = "")
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempdf = aggregate(Close ~ DateTime, data = tempdf, theAction)
tempIndicator = tempdf$Indicator[1]
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf)
}
}
}
thenames = unique(provisionaldf$Indicator)
provisionaldf = aggregate(Close ~ DateTime, data = provisionaldf, theAction)
provisionaldf$Indicator = paste(thenames,collapse = " + ")
dataFrame = rbind(dataFrame,provisionaldf)
}
dataFrame$DateTime <- as.Date(dataFrame$DateTime)
ggplot(dataFrame,aes(x=(DateTime), y=Close, colour=Indicator)) +
geom_line() +
xlab("") + ylab("") +
theme(axis.text.y = element_text(),
panel.border=element_blank(),
axis.line=element_line(colour = "grey",size=.3),
panel.background = element_blank(),
panel.grid.minor = element_line(colour = "grey",size=.2),
panel.grid.major = element_line(colour = "grey",size=.3)) +
theme(legend.position="right") +
ggtitle(object) +
theme(plot.title = element_text(face="bold"))
SINCE = "1999"
options(stringsAsFactors = FALSE)
subjects = "United States_#_Europe_-_Germany_#_Europe_"
subjects = gsub("_", "", subjects)
subjects = strsplit(subjects,"\\#")[[1]]
howManyLines = length(subjects)
dataFrame = list()
toDebug = ""
if(grepl("rate",tolower(object))){theAction = "mean"}else{theAction="sum"}
for(l in 1:howManyLines){
provisionaldf = list()
tempSubjects = strsplit(subjects[l],"\\+")[[1]]
for(t in 1:length(tempSubjects)){
tempdf = list()
if(grepl("\\-",tempSubjects[t])){
with = strsplit(tempSubjects,"\\-")[[1]][1]
without = strsplit(tempSubjects,"\\-")[[1]][2:length(strsplit(tempSubjects,"\\-")[[1]])]
if(is.na(match(tolower(with),tolower(GROUPS_OF_COUNTRIES)))){
tempdf=te.get.hist.multi.free.new(with,object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Country[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))] <- countrycode(tempdf$Country,"country.name","iso3c")[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))]
tempdf$Country[tolower(tempdf$Country)=="euro area"] <- "EA17"
tempdf$Indicator = tempdf$Country
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempIndicator = tempdf$Indicator[1]
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf)
}else{
withLogic = te.group.of.countries(with,without)
tempdf=te.get.hist.multi.free.new(withLogic,object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Indicator = paste(with,paste(countrycode(without,"country.name","iso3c")[!is.na(countrycode(without,"country.name","iso3c"))],collapse=" & "),sep=" - ")
tempdf$Indicator = paste("(",tempdf$Indicator,")", sep = "")
tempIndicator = tempdf$Indicator[1]
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempdf = aggregate(Close ~ DateTime, data = tempdf, theAction)
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf)
}
}else{
if(is.na(match(tolower(tempSubjects[t]),tolower(GROUPS_OF_COUNTRIES)))){
tempdf=te.get.hist.multi.free.new(tempSubjects[t],object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Indicator[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))] = countrycode(tempdf$Country,"country.name","iso3c")[!is.na(countrycode(tempdf$Country,"country.name","iso3c"))]
tempdf$Indicator[tolower(tempdf$Country)=="euro area"] <- "EA17"
tempdf$Indicator = paste("(",tempdf$Indicator,")", sep = "")
tempIndicator = tempdf$Indicator[1]
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf[c("DateTime","Close","Indicator")])
thenames = unique(provisionaldf$Indicator)
provisionaldf = aggregate(Close ~ DateTime, data = provisionaldf, theAction)
provisionaldf$Indicator = paste(thenames,collapse = " + ")
}else{
withLogic = te.group.of.countries(tempSubjects[t],"Atlantis")
tempdf=te.get.hist.multi.free.new(withLogic,object,d1=SINCE)
if(length(tempdf$Close)<1) next;
tempdf$Indicator = paste("(",tempSubjects[t],")", sep = "")
tempIndicator = tempdf$Indicator[1]
tempdf$DateTime <- as.yearmon(tempdf$DateTime)
tempdf = aggregate(Close ~ DateTime, data = tempdf, theAction)
tempdf = zoo(tempdf$Close,tempdf$DateTime)
tempdf = na.approx(tempdf, xout=as.yearmon(start(tempdf[1])+(0:(500))/12))
tempTempdf=list()
tempTempdf$Close = coredata(tempdf)
tempTempdf$DateTime = as.yearmon(time(tempdf))
tempTempdf$Indicator = tempIndicator
tempdf = data.frame(tempTempdf)
provisionaldf = rbind(provisionaldf,tempdf)
}
}
}
thenames = unique(provisionaldf$Indicator)
provisionaldf = aggregate(Close ~ DateTime, data = provisionaldf, theAction)
provisionaldf$Indicator = paste(thenames,collapse = " + ")
dataFrame = rbind(dataFrame,provisionaldf)
}
dataFrame$DateTime <- as.Date(dataFrame$DateTime)
ggplot(dataFrame,aes(x=(DateTime), y=Close, colour=Indicator)) +
geom_line() +
xlab("") + ylab("") +
theme(axis.text.y = element_text(),
panel.border=element_blank(),
axis.line=element_line(colour = "grey",size=.3),
panel.background = element_blank(),
panel.grid.minor = element_line(colour = "grey",size=.2),
panel.grid.major = element_line(colour = "grey",size=.3)) +
theme(legend.position="right") +
ggtitle(object) +
theme(plot.title = element_text(face="bold"))
