{
    "contents" : "//if(!location.pathname.match(\"^/ocpu/user/nuno/library/TE/www\")){\n//opencpu.seturl(\"http://forecasts.tradingeconomics.com/ocpu/user/nuno/library/TE/R\");}  \n//opencpu.seturl(\"../ocpu/library/TE/R\")\nopencpu.seturl(\"http://r.ieconomics.com/ocpu/library/TE/R\");\n\nvar home = \"http://r.ieconomics.com\";\nvar baseLoc = \"/apps/\";\nvar countries = [];\nvar indicators = [];\nvar regions = [];\n// var userN = \"guest\";\n// var passW = \"guest\";\nvar userN = \"r@tradingeconomics.com\";\nvar passW = \"Lisboa!1\";\nvar country = [];\nvar indicator = [];\nvar startDate = [];\nvar $tab = $('#myTab');\nvar firsthand = true;\n\n$('#startDate').datepicker({\n//   orientation:'top left',\n   format: 'mm-dd-yyyy',\n   viewMode: 'months',\n   minViewMode: 'months'\n});\n\n$(\"#plotdiv\").resizable();\n\n$('#plotdiv').bind('resize', function(){\n  $(\"#sharebutton\").attr('disabled', false);\n});\n\nfunction rIndicatorDD(country,callback){\n  indicator = $(\"#indicator\").val();\n // console.log(indicator)\n  jQuery.getJSON(home+'/indicators/'+country,function(){}).done(function(data) {\n  if(data.length<1){return;}\n  indicators = []\n  for(var i = 0;i<data.length;i++){\n    indicators[i]=data[i].cat\n  }\n  callback()\n  })\n}\nfunction rCountryDD(indicator,callback){\n  country = $(\"#country\").val();\n  jQuery.getJSON(home+'/countries/'+indicator,function(){}).done(function(data) {\n  if(data.length<1){return;}\n  countries = []\n  for(var i = 0;i<data.length;i++){\n    countries[i]=data[i].c\n  }\n  callback()\n  })\n}\nfunction bCountryDD(div,id,callback){\n        var cselec=\"\";\n         $(div).text('')\n        cselec += '<p>'//<b>Country</b>'\n        cselec += '<select class=\"form-control myselec\" id=\"'+id+'\">';\n        // cselec+= '<option value=\"Commodity\">Commodities</option>'\n         for(i=0;i<countries.length;i++){\n          cselec+= '<option value=\"' + countries[i] + '\">' + countries[i] + '</option>';}\n        cselec+='</select>';\n        cselec += '</p>'\n        $(div).append(cselec)\n        var pre = ['United States'];\n        setter(pre,id,callback)\n}\nfunction bIndicatorDD(div,id,callback,byDefault){\n  //console.log(byDefault)\n        var cselec=\"\";\n         $(div).text('')\n         cselec += '<p>' //<b>Indicator</b>'\n         cselec += '<select class=\"form-control myselec\" id=\"'+id+'\">';\n           for(i=0;i<indicators.length;i++){\n           cselec += '<option value=\"' + indicators[i] + '\">' + indicators[i] + '</option>';}\n        cselec += '</select>';\n        cselec += '</p>'\n        $(div).append(cselec)\n          if(byDefault){var pre = byDefault}else{var pre=['Unemployment Rate']};\n          setter(pre,id,callback)\n}\nfunction bRegionDD(div,id,callback,byDefault){\n        var cselec=\"\";\n         $(div).text('')\n         //cselec = '<b>Region:</b>'\n         cselec += '<select class=\"form-control myselec\" id=\"'+id+'\">';\n           for(i=0;i<regions.length;i++){\n           cselec+= '<option value=\"' + regions[i] + '\">' + regions[i] + '</option>';}\n        cselec+='</select>';\n        $(div).append(cselec)\n          if(byDefault){var pre = byDefault}else{var pre=['Europe']};\n          setter(pre,id,callback)\n}\nfunction bMultipleCountriesDD(div,id,callback,byDefault){\n       var selec = \"\"\n       $(div).text('')\n       selec += '<p>'// <b>Countries</b>'\n       selec += '<select id=\"'+id+'\" class=\"form-control myselec\" multiple=\"multiple\" size=\"19\">\\n'\n      for(j=0;j<countries.length;j++)\n       {\n       selec += '<option value=\"'+countries[j]+'\">'+countries[j]+'</option>'\n       }\n      selec += '</select>'\n      selec += '</p>'\n      selec += '<p>'\n      selec += '(HINT: Hold <b>CTRL</b> to select several Countries.)<br>'\n      $(div).append(selec)\n      if(byDefault){var prec = byDefault}else{var prec = ['United States','United Kingdom','China','Euro Area','Germany','Japan','France'];};\n      setter(prec,id,callback)     \n}\nfunction bMultipleIndicatorsDD(div,id,callback,byDefault){\n       var selec = \"\"\n       $(div).text('')\n       selec += '<p>'// <b>Indicators</b>'\n       selec += '<select id=\"'+id+'\" class=\"form-control myselec\" multiple=\"multiple\" size=\"19\">\\n'\n       for(j=0;j<indicators.length;j++)\n       {\n       selec += '<option value=\"'+indicators[j]+'\">'+indicators[j]+'</option>'\n       }\n      selec += '</select>'\n      selec += '</p>'\n      selec += '<p>'\n      selec += '(HINT: Hold <b>CTRL</b> to select several Indicators.)<br>'\n      $(div).append(selec)\n      if(byDefault){var prei = byDefault}else{var prei = ['Industrial Production','GDP Annual Growth Rate','Inflation Rate','Unemployment Rate'];};\n      setter(prei,id,callback)      \n}\nfunction loadInfo(callback){\ncountries = [];\nindicators = [];\n  $.getJSON(\"./indicators.json\", function( data1 ) {\n    $.each(data1, function(key, val){  \n    for(i=0;i<val.length;i++){\n    indicators.push(val[i]);}})\n    }).always(function() {\n      $.getJSON(\"./countries.json\", function( data2 ) {\n        $.each(data2, function(key, val){  \n        for(i=0;i<val.length;i++){\n        countries.push(val[i]);}})\n        }).always(function() {\n          $.getJSON(\"./regions.json\", function( data3 ) {\n            $.each(data3, function(key, val){  \n            for(i=0;i<val.length;i++){\n            regions.push(val[i]);}})\n            }).always(function() {\n              callback()          \n      });\n    });\n  });\n}     \nfunction rInteractPlot(type, auth, country, indicator, date, opts){\n    $(\"#sharebutton\").prop('disabled', true);\n    $(\"#seetable\").prop('disabled', true);\n    opts = typeof opts !== 'undefined' ? opts : null;\n    var myObj = {\n          c : auth,\n          country : country,\n          indicator : indicator,\n          d1 : date,\n          opts : opts\n        }\n    \n    if( date && new Date()<new Date(date)){\n      throwAlert(\"Invalid time period\")\n      $('#loadingDiv').hide();\n      $(\"#submitbutton\").prop('disabled', false);\n      return;\n    }   \n    if(!(country && indicator) && type!=\"te.geomap\"){\n      throwAlert(\"Please, select parameters\")\n      $('#loadingDiv').hide();\n      $(\"#submitbutton\").prop('disabled', false);\n      return;\n      // $(\"#alert\").append('<div class=\"alert alert-warning alert-dismissable\">  <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-hidden=\"true\">&times;</button><strong>Alert!</strong> Please, select parameters.');\n    }\n    \n    if(country.length>70 || indicator.length>70)\n    {\n      $(\"#submitbutton\").prop('disabled', false);\n      $('#loadingDiv').hide();\n      throwAlert(\"Too many indicators to show. Please re-do selection\")\n      //$(\"#alert\").append('<div class=\"alert alert-warning alert-dismissable\">  <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-hidden=\"true\">&times;</button> <strong>Alert.</strong> Too many indicators to show. Please re-do selection.</div>');\n    }else{\n        var req = $(\"#plotdiv\").r_fun_plot(type, myObj)\n        req.fail(function(){\n          $(\"#sharebutton\").attr('data-ready','true')\n          $('#loadingDiv').hide();\n          $(\"#submitbutton\").prop('disabled', false);\n          logThis(req.responseText)\n          throwAlert(\"We are sorry but at the moment we cannot complete your request. Please, re-check the parameters and let us know if the problem persists\",\"danger\")\n        //  $(\"#alert\").append('<div class=\"alert alert-danger alert-dismissable\">  <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-hidden=\"true\">&times;</button> <strong>Process interrupted.</strong>  We are sorry but at the moment we cannot complete your request. Please, re-check the parameters and let us know if the problem persists. </div>');\n        });\n        req.success(function(){\n          $(\"#sharebutton\").attr('data-ready','true')\n          $('#loadingDiv').hide();\n          $(\"#submitbutton\").prop('disabled', false);\n          $(\"#sharebutton\").removeAttr(\"style\")\n          $(\"#sharebutton\").prop('disabled', false);\n      //  $(\"#seetable\").removeAttr(\"style\")\n      //  $(\"#seetable\").prop('disabled', false);\n        });\n        req.always(function(){\n      });      \n    }    \n  }\nfunction throwAlert(msg,atype){\n  $(\"#alert\").text('')\n  $(\"#alert\").append('<div class=\"alert alert-'+ (atype || 'warning') +' alert-dismissable\">  <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-hidden=\"true\">&times;</button><strong>Alert!</strong> '+msg+'.')\n}\nfunction rInteractTable(type, auth, country, indicator, date){\n  $(\"#seetable\").prop('disabled', true);\n     var tbl = opencpu.r_fun_json(\"te.table\", {\n          c : auth,\n          countries : country,\n          indicators : indicator,\n          d1 : date,\n          what : type\n        }, function(output){\n         // $('#tablediv').text('!'+JSON.stringify(output));\n          $('#tablediv').text('');\n          var mt = '<table id=\"tdiv\" class=\"tablesorter\">';\n          mt += '<thead>';\n          mt += '<tr>';\n          mt += '<th>Country</th><th>Category</th><th>DateTime</th><th>Value</th>';\n          mt += '</tr>';\n          mt += '</thead>';\n          mt += '<tbody>';\n          for(i=0;i<output.Value.length;i++){\n            mt += '<tr><td>'+output.Country[i]+'</td><td>'+output.Category[i]+'</td><td>'+output.DateTime[i]+'</td><td>'+output.Value[i]+'</th></tr>';\n          }            \n          mt += '</tbody>';\n          mt += '</table>';\n          mt += '<div id=\"pager\" class=\"pager\" style=\"top: 1417px; position: absolute;\">';\n          mt += '<form>';\n\t      \tmt += '<img src=\"dist/addons/pager/icons/first.png\" class=\"first\">';\n      \t\tmt += '<img src=\"dist/addons/pager/icons/prev.png\" class=\"prev\">';\n\t      \tmt += '<input type=\"text\" class=\"pagedisplay\">';\n      \t\tmt += '<img src=\"dist/addons/pager/icons/next.png\" class=\"next\">';\n      \t\tmt += '<img src=\"dist/addons/pager/icons/last.png\" class=\"last\">';\n      \t\tmt += '<select class=\"pagesize\">';\n    \t\t\tmt += '<option selected=\"selected\" value=\"15\">15</option>';\n\t    \t\tmt += '<option value=\"30\">30</option>';\n\t\t    \tmt += '<option value=\"50\">50</option>';\n\t\t    \tmt += '<option value=\"100\">100</option>';\n      \t\tmt += '</select>';\n        \tmt += '</form>';\n          mt += '</div>';\n          $(\"#tablediv\").append(mt);\n          \n          $(\"#tdiv\").tablesorter({\n            theme:'blue',\n          }).tablesorterPager({container: $(\"#pager\"),\n                              size: 15\n          }); \n          \n        })\n\n        tbl.fail(function(){\n          logThis(tbl.responseText)\n          $(\"#alert\").append('<div class=\"alert alert-warning alert-dismissable\">  <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-hidden=\"true\">&times;</button><strong>ERROR!</strong> We are sorry but at the moment we cannot complete your request. Let us know if the problem persists.');\n        }); \n      }      \nfunction shareThis(){ \n  var path = \".\"\n  check()\n  //console.log(document.getElementById(\"the_iframe\").attr(\"\"))\n  console.log(document.URL)\n  $(\"#embbed\").text('')\n  $(\"#sharebutton\").attr('disabled', 'disabled');\n  url=$('a[target=\"_blank\"]').attr('href')\n  url=url.substr(0, url.indexOf('/graph')).substr(url.indexOf(\"tmp/\") + 4)\n  console.log(url)\n  id=randomString(15)\n  if(typeof opts == 'undefined'){opts=null}\n  if(typeof startDate == 'undefined'){startDate=null}\n  $.ajax({\n  url: \"/s/\",\n  data: {\n         f:url,\n         id:id,\n         type:type, \n         country: JSON.stringify(country), \n         indicator: JSON.stringify(indicator), \n         d1: startDate, \n         opts:JSON.stringify(opts),\n         c:userN,\n         w: $('#plotdiv').width(),\n         h: $('#plotdiv').height()\n  }\n}).done(function(data) {\n    var embbed = '<div class=\"shareit\" data-id=\"'+data+'\" data-home=\"'+ baseLoc +'\" data-type=\"TEanalytics\"></div><script type=\"text/javascript\" src=\"'+home+'/share.js\"></script>';\n \n  $(\"#embbed\").append('<form action=\"\"><textarea readonly=\"readonly\" rows=\"2\" cols=\"40\" style=\"overflow: hidden; margin: 2px; width: 476px; height: 48px;\">'+embbed+'</textarea></form><button id=\"preview\">Preview!</button>');\n  \n//  $(\"#embbed\").append(\"got smth: \" + data);\n$(\"#preview\").on(\"click\", function(){  \n  $(\"#seetable\").prop('disabled', true);\n  //$('#tablediv').text('').append(embbed)\n  var w = window.open('', '', 'width=1000,height=800,resizeable,scrollbars');\n      w.document.write(embbed);\n      w.document.close();\n});\n});\n}\nfunction check(){\nif (window.top!=window.self) \n  {\n  //console.log(\"This window is not the topmost window! Am I in a frame?\")\n  baseLoc = getUrlVars()['loc']\n  }\nelse\n  { \n  console.log(\"This window is the topmost window!\")\n  } \n}\nfunction logThis(message){\n  $.ajax({\n  url: \"http://forecasts.tradingeconomics.com:9999/logs/\",\n  data: {t:type,\n    c : country,\n    i : indicator,\n    l:message}\n});\n}\nfunction randomString(length){\n    var chars = '000111222333444555666777888999aabbccddeeffgghhiijjkkllmmnnooppqqrrssttuuvvwwxxyyzzABCDEFGHIJKLMNOPQRSTUVWXYZ'\n    var result = '';\n    for (var i = length; i > 0; --i) result += chars[Math.round(Math.random() * (chars.length - 1))];\n    return result;\n}\nfunction starts(){\n  $('#plotdiv').append('<img src=\"loader2.gif\" id=\"loadingDiv\" height=\"42\" width=\"42\">')\n  $('#loadingDiv').show();\n  $(\"#submitbutton\").prop('disabled', false);\n  $(\"#sharebutton\").on(\"click\", function(){        \n    shareThis()\n  });\n}\nfunction submits(){\n  //$('#plotdiv').empty()\n  $(\"#embbed\").text('')\n  $('#tablediv').text('')\n  //$('#plotdiv').append('<img src=\"loader2.gif\" id=\"loadingDiv\" height=\"42\" width=\"42\">')\n  $('#loadingDiv').show();\n  $(\"#submitbutton\").attr('disabled', 'disabled');\n  $('#alert').text('')\n}\nfunction getUrlVars(){\n    var vars = [], hash;\n    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');\n    for(var i = 0; i < hashes.length; i++)\n    {\n        hash = hashes[i].split('=');\n        vars.push(hash[0]);\n        vars[hash[0]] = hash[1];\n    }\n    return vars;\n}\nfunction dcode(json){\n  na=(JSON.stringify(json).replace(/\\]/g,' ').replace(/\\[/g,' ').replace(/\\+/g,' ').replace(/\\\\/g,' ').replace(/\\\"/g,' ')).split(',');\n  for(var i = 0; i < na.length; i++)\n    na[i] = na[i].trim();\n  return na\n}\nfunction doset(selec,type){\n$('#'+type+' option').attr(\"selected\", false);\n    for(i=0;i<selec.length;i++){\n    $('#'+type+' option[value=\"'+selec[i]+'\"]').attr('selected','selected');\n  }\n}\nfunction setter(selec,type,callback){\n  if(typeof getUrlVars()['id'] != 'undefined'){\n//console.log('with ID ')\n  var req = $.ajax({\n    url: \"http://forecasts.tradingeconomics.com:9999/inf/\"+getUrlVars()['id']\n  });\n  req.always(function(){\n    info = jQuery.parseJSON(req.responseText);\n    $(\"#plotdiv\").css(\"width\",info.w);\n    $(\"#plotdiv\").css(\"height\",info.h);\n//$(\"#tablediv\").append(info.type);\n    switch(info.type)\n    {\n      case 'te.plot':\n      case 'te.plot.compare.scale':\n      case 'te.heat.map':\n      case 'te.tree.map':\n      case 'te.pie.chart':\n       switch(type){\n         case 'country':\n//$(\"#tablediv\").append(\"+\"+dcode(info.c)[1]+\"+\");\n           doset(dcode(info.c),type);\n           break;\n        case 'indicator':\n           doset(dcode(info.i),type);\n           break;\n       }\n       break;\n      case 'te.simplecorrelation.matrix':\n      case 'te.correlation.matrix':\n      case 'te.plot.multi':\n      $active = $tab.find('.active');\n      var shouldbe=1;\n      if(dcode(info.c).length<2&&dcode(info.i).length>1){shouldbe=2}\n      if(dcode(info.c).length>1&&dcode(info.i).length>1){shouldbe=3}\n//$(\"#tablediv\").text(shouldbe+' + '+$active.attr(\"data-num\"))\n      if($active.attr(\"data-num\")==shouldbe || !firsthand){\n      if($active.attr(\"data-num\")!=shouldbe){callback = function(){}}\n       switch(type){\n         case 'country':\n//$(\"#tablediv\").append(\"+\"+dcode(info.c)[1]+\"+\");\n           doset(dcode(info.c),type);\n           break;\n        case 'indicator':\n           doset(dcode(info.i),type);\n           break;\n       }\n      }else{\n      //if($active.attr(\"data-num\")!=shouldbe){\n        $('a[data-num=\"'+shouldbe+'\"]').tab('show');\n        firsthand=false\n      }\n       break;\n      case 'te.plot.compare':\n       switch(type){\n         case 'country':\n           doset(dcode(info.c),type);\n           break;\n        case 'indicator1':\n           doset([dcode(info.i)[0]],type);\n           break;\n        case 'indicator2':\n           doset([dcode(info.i)[1]],type);\n           break;\n       }\n       break;\n      case 'te.geomap':\n           doset(dcode(info.opts),'region');\n       switch(type){\n        case 'indicator':\n           doset(dcode(info.i),type);\n           break;\n       }\n       break;\n      default:\n      console.log('not found')\n  }\n  //callback()\n});  \n\nreq.then(function()\n{\ncallback()\n})\n\n  }else{\n//  req = req.replace(/\\+/g,' ')\n//  reqarray=req.split(',');\n    doset(selec,type)\n    callback()\n}\n  \n}\nfunction test(){\n  $(\"#tablediv\").text($(\"#sharebutton\").attr('data-ready')+'?')\n}",
    "created" : 1391618321851.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "503124336",
    "id" : "2E9FFDAB",
    "lastKnownWriteTime" : 1392823407,
    "path" : "~/TE/inst/www/helper.js",
    "project_path" : "inst/www/helper.js",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "js"
}